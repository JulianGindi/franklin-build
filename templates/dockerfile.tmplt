FROM node:4.3


RUN mkdir -p /root/.ssh
ADD tmpkey/id_rsa /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa
RUN ssh-keyscan github.com >> /root/.ssh/known_hosts



{{if .TAG}}
RUN git clone -b {{ .TAG }} git@github.com:{{ .REPO_OWNER }}/{{ .REPO_NAME }}.git
{{else}}
RUN git clone -b {{ .BRANCH }} git@github.com:{{ .REPO_OWNER }}/{{ .REPO_NAME }}.git
RUN cd {{ .REPO_NAME }} && git checkout {{ .HASH }}
{{end}}

RUN cd {{ .REPO_NAME }} && npm install
RUN cd {{ .REPO_NAME }} && npm run build
